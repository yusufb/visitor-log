<?

class Visitor{

	private $referer;
	private $ip;
	private $userAgent;

	function __construct(){
		$this->referer = empty($_SERVER['HTTP_REFERER']) ? 'no referer' : $_SERVER['HTTP_REFERER'] ;
		$this->ip = $_SERVER['REMOTE_ADDR'];
		$this->userAgent = $_SERVER['HTTP_USER_AGENT'];
	}

	function getDataFromIp(){
		$data = file_get_contents('http://ip-api.com/json/' . $this->ip);
		if(!empty($data)){
			$ipData = json_decode($data);
			if($ipData->status === 'success'){
				return $ipData->country . '/' . $ipData->regionName . '/' . $ipData->city;
			}
		}
	}

	function getWriteData(){
		return date('d.m.Y H:i:s') . ' ' . $this->referer . ' ' . $this->ip . ' ' . $this->userAgent . ' ' . $this->getDataFromIp();

	}

}

date_default_timezone_set('Europe/Istanbul');
$v = new Visitor();
$v->test();

?>